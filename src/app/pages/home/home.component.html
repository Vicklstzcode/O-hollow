<div class="min-h-screen relative flex flex-col">
  <!-- Canvas original restaurado -->
  <canvas id="particles-canvas"></canvas>

  <app-navbar [favoritesCount]="favoritos.length">
    <!-- Botões de Ação específicos para a Home Page -->
    <div navbar-actions class="hidden md:flex items-center gap-4">
      <a
        *ngIf="!usuarioLogado"
        routerLink="/login"
        class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-full text-sm transition-all border border-white/5 cursor-pointer"
      >
        Login
      </a>
      <button *ngIf="usuarioLogado" (click)="sair()"
        class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-full text-sm transition-all border border-white/5 cursor-pointer"
      >
        Sair
      </button>
    </div>
  </app-navbar>

  <button
    *ngIf="mostrarBotaoVoltarAoTopo"
    (click)="scrollToTop()"
    class="fixed bottom-5 right-5 bg-purple-600 text-white p-3 rounded-full shadow-lg hover:bg-purple-700 transition-all z-50"
  >
    <i data-lucide="arrow-up" class="w-6 h-6"></i>
  </button>

  <main
    class="flex-grow pt-24 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto pb-12 w-full"
  >
    <div
      class="grid lg:grid-cols-2 gap-12 items-center mb-20 animate-fade-in-up"
    >
      <div>
        <div
          class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-purple-500/10 border border-purple-500/20 text-purple-400 text-xs font-bold mb-6"
        >
          <span class="relative flex h-2 w-2">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-purple-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-2 w-2 bg-purple-500"
            ></span>
          </span>
          ULTIMAS ATUALIZAÇÕES: Novos heróis e poderes adicionados!
        </div>

        <h1 class="text-5xl md:text-7xl font-bold mb-6 leading-tight">
          Todos os caminhos, <br />
          <span
            class="bg-gradient-to-r from-purple-500 via-pink-500 to-cyan-500 bg-clip-text text-transparent"
            >se encontram aqui.</span
          >
        </h1>

        <p class="text-gray-400 text-lg max-w-xl mb-8 leading-relaxed">
          Acesse a base de dados de seus heróis, vilões e entidades cósmicas
          favoritas. Compare poderes e decida batalhas.
        </p>

        <div class="relative max-w-md mb-8 group">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i
              data-lucide="search"
              class="h-5 w-5 text-gray-500 group-focus-within:text-purple-400 transition-colors"
            ></i>
          </div>
          <input
            type="text"
            (input)="filtrarPorBusca($event)"
            class="block w-full pl-10 pr-3 py-4 border border-white/10 rounded-xl leading-5 bg-white/5 text-white placeholder-gray-500 focus:outline-none focus:bg-white/10 focus:ring-2 focus:ring-purple-500/50 transition-all"
            placeholder="Busque por herói, universo ou poder..."
          />
        </div>

        <!-- ======================= PAINEL DO USUÁRIO ======================= -->
        <div *ngIf="usuarioLogado && usuario" class="mt-10">
          <h3
            class="text-sm font-bold text-purple-400 uppercase tracking-wider mb-4"
          >
            Seu Painel
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <!-- Card Favoritos -->
            <a
              routerLink="/favoritos"
              class="glass-panel p-4 rounded-lg hover:bg-white/10 transition-colors flex items-center gap-4"
            >
              <div
                class="w-12 h-12 bg-pink-500/20 rounded-lg flex items-center justify-center"
              >
                <i data-lucide="heart" class="w-6 h-6 text-pink-400"></i>
              </div>
              <div>
                <p class="text-sm text-gray-400">Favoritos</p>
                <p class="text-xl font-bold text-white">
                  {{ favoritos.length }}
                </p>
              </div>
            </a>
            <!-- Card Sequência -->
            <div class="glass-panel p-4 rounded-lg flex items-center gap-4">
              <div
                class="w-12 h-12 bg-orange-500/20 rounded-lg flex items-center justify-center"
              >
                <i data-lucide="flame" class="w-6 h-6 text-orange-400"></i>
              </div>
              <div>
                <p class="text-sm text-gray-400">Sequência</p>
                <p class="text-xl font-bold text-white">5 dias</p>
                <!-- Dado estático por enquanto -->
              </div>
            </div>
            <!-- Card Dashboard -->
            <a
              routerLink="/dashboard"
              class="glass-panel p-4 rounded-lg hover:bg-white/10 transition-colors flex items-center gap-4"
            >
              <div
                class="w-12 h-12 bg-cyan-500/20 rounded-lg flex items-center justify-center"
              >
                <i
                  data-lucide="layout-dashboard"
                  class="w-6 h-6 text-cyan-400"
                ></i>
              </div>
              <div>
                <p class="text-sm text-gray-400">Acessar</p>
                <p class="text-xl font-bold text-white">Dashboard</p>
              </div>
            </a>
          </div>
        </div>
      </div>

      <div
        *ngIf="carouselItems.length > 0"
        class="relative h-[500px] w-full rounded-2xl overflow-hidden shadow-2xl border border-white/10 group"
      >
        <div class="w-full h-full relative">
          <img
            [src]="carouselItems[carouselIndex].image"
            class="w-full h-full object-cover transition-all duration-500"
          />
        </div>

        <div
          class="absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-black via-black/80 to-transparent z-10"
        >
          <h3 class="text-3xl font-bold text-white mb-1">
            {{ carouselItems[carouselIndex].name }}
          </h3>
          <p class="text-purple-400 font-medium">
            {{ carouselItems[carouselIndex].alias }}
          </p>
        </div>

        <div class="absolute top-4 right-4 flex gap-2 z-20">
          <button
            class="p-2 rounded-full bg-black/50 hover:bg-purple-600 transition-colors cursor-pointer"
            (click)="slideAnterior()"
          >
            <i data-lucide="chevron-left" class="w-5 h-5"></i>
          </button>
          <button
            class="p-2 rounded-full bg-black/50 hover:bg-purple-600 transition-colors cursor-pointer"
            (click)="proximoSlide()"
          >
            <i data-lucide="chevron-right" class="w-5 h-5"></i>
          </button>
        </div>
      </div>
    </div>

    <div
      class="flex flex-wrap gap-3 mb-10 justify-center md:justify-start overflow-x-auto pb-2"
    >
      <button
        *ngFor="let filtro of filtros"
        (click)="mudarFiltro(filtro)"
        class="filter-btn px-5 py-2 rounded-full font-medium text-sm transition-all border border-white/10 cursor-pointer"
        [ngClass]="{
          'bg-purple-600 text-white': filtroAtual === filtro,
          'glass-panel text-gray-300 hover:bg-white/10': filtroAtual !== filtro
        }"
      >
        {{ filtro }}
      </button>
    </div>

    <div id="featured-section" class="mb-20">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold flex items-center gap-2 text-white">
          <i data-lucide="sparkles" class="text-yellow-500"></i> Destaques
        </h2>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <!-- Indicador de Carregamento -->
        <div *ngIf="filtrandoPersonagens" class="col-span-3 text-center py-10">
          <div class="flex justify-center items-center gap-3 text-gray-400">
            <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
            <span class="text-lg">Filtrando...</span>
          </div>
        </div>

        <div
          *ngIf="!filtrandoPersonagens && personagensFiltrados.length === 0"
          class="col-span-3 text-center text-gray-500 py-10"
        >
          Nenhum herói encontrado.
        </div>

        <!-- Container para agrupar os cards e aplicar o *ngIf -->
        <ng-container *ngIf="!filtrandoPersonagens">
          <a
            *ngFor="let char of personagensFiltrados; let i = index"
            [routerLink]="['/detalhes', char.id]"
            class="group block relative glass-panel rounded-xl overflow-hidden neon-hover transition-all duration-300 animate-fade-in-up cursor-pointer"
            [style.animation-delay]="i * 100 + 'ms'"
          >
            <div class="aspect-[3/4] relative overflow-hidden">
              <img
                [src]="char.image"
                [alt]="char.name"
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
              />
              <div
                class="absolute inset-0 bg-gradient-to-t from-[#121212] via-transparent to-transparent opacity-90"
              ></div>

              <button
                (click)="toggleFavorito(char.id, $event)"
                class="absolute top-3 right-3 p-2 rounded-full transition-all z-20 transform translate-y-[-10px] opacity-0 group-hover:translate-y-0 group-hover:opacity-100"
                [ngClass]="
                  ehFavorito(char.id)
                    ? 'bg-pink-600/80 opacity-100 translate-y-0 text-white'
                    : 'bg-black/50 backdrop-blur text-white'
                "
              >
                <i
                  data-lucide="heart"
                  class="w-4 h-4"
                  [ngClass]="{ 'fill-white': ehFavorito(char.id) }"
                ></i>
              </button>
            </div>

            <div class="absolute bottom-0 left-0 right-0 p-6">
              <div class="flex justify-between items-start mb-2">
                <div
                  class="inline-block px-2 py-1 rounded text-[10px] font-bold tracking-wider border border-white/10"
                  [style.background-color]="char.color + '20'"
                  [style.color]="char.color"
                >
                  {{ char.universe | uppercase }}
                </div>
              </div>

              <h3
                class="text-xl font-bold text-white mb-1 group-hover:text-purple-400 transition-colors"
              >
                {{ char.name }}
              </h3>
              <p class="text-gray-400 text-xs mb-3 uppercase tracking-wide">
                {{ char.alias }}
              </p>

              <div
                class="flex items-center gap-2 text-sm pt-3 border-t border-white/10"
              >
                <i
                  data-lucide="zap"
                  class="w-3 h-3"
                  [style.color]="char.color"
                ></i>
                <span class="text-gray-300 text-xs truncate">{{
                  char.power
                }}</span>
              </div>
            </div>
          </a>
        </ng-container>
      </div>
    </div>

    <!-- ======================= NÍVEL DE AMEAÇA ======================= -->
    <div
      id="threat-level"
      class="mb-20 p-1 rounded-2xl bg-gradient-to-r from-red-500 via-orange-600 to-yellow-600"
    >
      <div class="bg-black rounded-xl p-8 text-center relative overflow-hidden">
        <div
          class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"
        ></div>

        <div *ngIf="personagemAmeaca" class="relative z-10 max-w-2xl mx-auto">
          <h2 class="text-3xl font-black italic mb-2 text-white">
            NÍVEL DE AMEAÇA
          </h2>
          <p class="text-gray-400 mb-6">
            Qual o nível de ameaça de
            <span class="font-bold" [style.color]="personagemAmeaca.color">{{
              personagemAmeaca.name
            }}</span
            >?
          </p>

          <img
            [src]="personagemAmeaca.image"
            class="w-32 h-32 md:w-40 md:h-40 object-cover rounded-full mx-auto mb-6 border-4"
            [style.border-color]="personagemAmeaca.color"
            [style.box-shadow]="'0 0 30px ' + personagemAmeaca.color + '60'"
          />

          <div class="flex flex-wrap justify-center gap-3">
            <button
              *ngFor="let nivel of niveisAmeaca"
              (click)="votarAmeaca(nivel.id)"
              [disabled]="ameacaVotada"
              class="px-4 py-2 rounded-full text-xs font-bold border transition-all"
              [ngClass]="{
                'cursor-not-allowed opacity-50': ameacaVotada,
                'hover:bg-white/20': !ameacaVotada
              }"
              [style.border-color]="nivel.cor"
              [style.color]="nivel.cor"
            >
              {{ nivel.nome }}
            </button>
          </div>

          <button
            (click)="novoDesafioAmeaca()"
            class="mt-8 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-full text-xs transition-all border border-white/10 cursor-pointer flex items-center gap-2 mx-auto"
          >
            <i data-lucide="refresh-cw" class="w-3 h-3"></i>
            Próximo Desafio
          </button>
        </div>
      </div>
    </div>

    <!-- ======================= CONEXÕES DO MULTIVERSO ======================= -->
    <div
      id="multiverse-connections"
      class="mb-20 p-1 rounded-2xl bg-gradient-to-r from-cyan-500 via-blue-600 to-indigo-600"
    >
      <div class="bg-black rounded-xl p-8 text-center relative overflow-hidden">
        <div
          class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"
        ></div>

        <div *ngIf="personagemCentral" class="relative z-10 max-w-4xl mx-auto">
          <h2 class="text-3xl font-black italic mb-2 text-white">
            CONEXÕES DO MULTIVERSO
          </h2>
          <p class="text-gray-400 mb-8">
            Explore as relações e conexões dos personagens.
          </p>

          <div
            class="flex flex-col md:flex-row items-center justify-center gap-8"
          >
            <!-- Personagens Conectados (Esquerda) -->
            <div class="flex flex-col gap-4">
              <div
                *ngFor="let char of personagensConectados.slice(0, 2)"
                (click)="mudarPersonagemCentral(char.id)"
                class="flex items-center gap-3 cursor-pointer group"
              >
                <img
                  [src]="char.image"
                  class="w-12 h-12 rounded-full object-cover border-2 border-white/20 group-hover:border-purple-400 transition-all"
                />
                <span
                  class="text-sm font-bold text-gray-300 group-hover:text-white transition-colors"
                  >{{ char.name }}</span
                >
              </div>
            </div>

            <!-- Personagem Central -->
            <div class="text-center">
              <img
                [src]="personagemCentral.image"
                class="w-40 h-40 md:w-56 md:h-56 object-cover rounded-full mx-auto mb-4 border-4 border-purple-500 shadow-[0_0_40px_rgba(139,92,246,0.6)]"
              />
              <h3 class="text-2xl font-bold text-white">
                {{ personagemCentral.name }}
              </h3>
            </div>

            <!-- Personagens Conectados (Direita) -->
            <div class="flex flex-col gap-4">
              <div
                *ngFor="let char of personagensConectados.slice(2, 4)"
                (click)="mudarPersonagemCentral(char.id)"
                class="flex items-center gap-3 cursor-pointer group"
              >
                <img
                  [src]="char.image"
                  class="w-12 h-12 rounded-full object-cover border-2 border-white/20 group-hover:border-purple-400 transition-all"
                />
                <span
                  class="text-sm font-bold text-gray-300 group-hover:text-white transition-colors"
                  >{{ char.name }}</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer
    class="w-full bg-black/30 border-t border-white/10 mt-auto py-6 px-4 sm:px-6 lg:px-8"
  >
    <div
      class="max-w-7xl mx-auto text-center text-gray-400 flex flex-col md:flex-row justify-between items-center gap-4"
    >
      <p class="text-sm">&copy; 2024 Mysticos. Todos os direitos reservados.</p>
      <div class="flex items-center gap-6 text-sm">
        <a href="#" class="hover:text-purple-400 transition-colors">Sobre</a>
        <a href="#" class="hover:text-purple-400 transition-colors"
          >Política de Privacidade</a
        >
        <a href="#" class="hover:text-purple-400 transition-colors">Contato</a>
      </div>
      <div class="flex justify-center gap-4">
        <a href="#" class="text-gray-500 hover:text-white transition-colors"
          ><i data-lucide="twitter" class="w-5 h-5"></i
        ></a>
        <a href="#" class="text-gray-500 hover:text-white transition-colors"
          ><i data-lucide="instagram" class="w-5 h-5"></i
        ></a>
      </div>
    </div>
  </footer>
</div>
